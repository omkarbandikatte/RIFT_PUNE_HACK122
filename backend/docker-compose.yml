version: '3.8'

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile.api
    ports:
      - "8000:8000"
    volumes:
      - ./workspace:/app/workspace
      - ./results.json:/app/results.json
      - /var/run/docker.sock:/var/run/docker.sock  # Allow API to create Docker containers
    environment:
      - PYTHONUNBUFFERED=1
    restart: unless-stopped
    depends_on:
      - agent
  
  # Agent image (pre-built for fast execution)
  agent:
    build:
      context: .
      dockerfile: docker/Dockerfile.agent
    image: rift-agent:latest
    profiles:
      - manual  # Don't run automatically, only used by API
